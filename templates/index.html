{% load static %}

{% block style %}
    <link rel="stylesheet" type="text/css" href="{% static "bootstrap/css/bootstrap.min.css" %}" />
{% endblock %}


{{ user.get_username }}
<form method="post" id="file-upload-form" enctype="multipart/form-data" action="/FileValidate/" > 
    {% csrf_token %}
    <div class="container-fluid">
        <div class="input-group">
            <div class="custom-file">
            <input type="file" class="custom-file-input" id="file"  accept=".csv">
            <label class="custom-file-label" for="inputGroupFile04">Choose file</label>
            </div>
            <div class="input-group-append">
            <button id ="check" class="btn btn-outline-secondary" type="button">Button</button>
            </div>
        </div>
    </div>
</form>


<!-- Image loader -->
<div  id='loader' style='display: none; text-align: center;'>
    <img src=' {{ MEDIA_URL }} /media/loader.gif ' width='200px' height='200px' type = 'text/html'>
</div>




<script src="{% static "jquery/jquery-3.5.1.min.js" %}"></script>
<script>
    $('#check').click(function(event){ 
        var file_data = $('#file').get(0).files[0]; // note [0]
        var formData = new FormData();
        formData.append('file_data', file_data);
        $.ajax( 
            { 
                type:"POST", 
                url: '{% url "validate" %}', 
                data: formData,
                processData: false,
                contentType: false,

            beforeSend: function(){
                // Show image container
                $("#loader").show();
            },    

            success: function( data ) 
            { 
            console.log(data) 
            if(data=="success"){
                console.log(data)
            }
            else{
                alert(data) 
            }
          },
          error: function(data) {
            console.log('Failed');
            },
            complete:function(data){
                // Hide image container
                $("#loader").hide();
            } 
        })
    });
</script>